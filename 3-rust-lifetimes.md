---
theme: default
title: "–õ–µ–∫—Ü–∏—è 3: Rust ‚Äî Lifetimes & Borrow Checker"
info: |
  –ì–ª—É–±–æ–∫–æ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ –≤ —Å–∏—Å—Ç–µ–º—É –≤–ª–∞–¥–µ–Ω–∏—è Rust:
  Ownership, Borrowing, Lifetimes –∏ Borrow Checker.
transition: slide-left
mdc: true
lineNumbers: true
drawings:
  persist: false
fonts:
  mono: Fira Code
---

# –õ–µ–∫—Ü–∏—è 3: Rust ‚Äî Lifetimes & Borrow Checker

<div class="pt-8">
  <span class="text-xl text-gray-400">
    –ö–∞–∫ Rust –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–∞–º—è—Ç–∏ –±–µ–∑ —Å–±–æ—Ä—â–∏–∫–∞ –º—É—Å–æ—Ä–∞
  </span>
</div>

<div class="abs-br m-6 text-gray-500 text-sm">
  2026
</div>

<!--
–°–µ–≥–æ–¥–Ω—è –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ —Å–∞–º–æ–π —É–Ω–∏–∫–∞–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ Rust ‚Äî —Å–∏—Å—Ç–µ–º–µ –≤–ª–∞–¥–µ–Ω–∏—è –∏ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–∏—Å–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–æ–¥ –±–µ–∑ GC.
-->

---

# –ü—Ä–æ–±–ª–µ–º–∞: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é

<div class="grid grid-cols-2 gap-8 mt-4">
<div>

### C / C++

- –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (`malloc`/`free`)
- Use-after-free, double free, dangling pointers
- Buffer overflows
- **~70% —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π** –≤ Chrome, Windows, Android

</div>
<div>

### –Ø–∑—ã–∫–∏ —Å GC (Java, Go, Python)

- –°–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ (Garbage Collector)
- –ü–∞—É–∑—ã GC (stop-the-world)
- –ë–æ–ª—å—à–∏–π —Ä–∞—Å—Ö–æ–¥ –ø–∞–º—è—Ç–∏
- –ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

</div>
</div>

<div v-click class="mt-8 p-4 bg-orange-500/10 border border-orange-500/30 rounded-lg text-center text-lg">

**Rust**: –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–∞–º—è—Ç–∏ –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏, –±–µ–∑ GC, –±–µ–∑ —Ä–∞–Ω—Ç–∞–π–º-–æ–≤–µ—Ä—Ö–µ–¥–∞

</div>

<!--
70% —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–∞–º—è—Ç–∏ ‚Äî —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç Microsoft –∏ Google. Rust —Ä–µ—à–∞–µ—Ç —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É —É–Ω–∏–∫–∞–ª—å–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º.
-->

---
layout: section
---

# Ownership
## –°–∏—Å—Ç–µ–º–∞ –≤–ª–∞–¥–µ–Ω–∏—è

---

# –¢—Ä–∏ –ø—Ä–∞–≤–∏–ª–∞ Ownership

<v-clicks>

1. **–£ –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –µ—Å—Ç—å —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω –≤–ª–∞–¥–µ–ª–µ—Ü** (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è)
2. **–í –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ ‚Äî —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –≤–ª–∞–¥–µ–ª–µ—Ü**
3. **–ö–æ–≥–¥–∞ –≤–ª–∞–¥–µ–ª–µ—Ü –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ scope ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è** (`drop`)

</v-clicks>

<div v-click class="mt-6">

```rust
fn main() {
    let s1 = String::from("hello");  // s1 ‚Äî –≤–ª–∞–¥–µ–ª–µ—Ü
    let s2 = s1;                     // ownership –ø–µ—Ä–µ—à—ë–ª –∫ s2
    // println!("{s1}");             // ‚ùå –û–®–ò–ë–ö–ê: s1 –±–æ–ª—å—à–µ –Ω–µ –≤–ª–∞–¥–µ–µ—Ç –¥–∞–Ω–Ω—ã–º–∏
    println!("{s2}");                // ‚úÖ OK: s2 ‚Äî –≤–ª–∞–¥–µ–ª–µ—Ü
}                                    // s2 –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ scope ‚Üí –ø–∞–º—è—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∞
```

</div>

<!--
–≠—Ç–æ move-—Å–µ–º–∞–Ω—Ç–∏–∫–∞. s1 –Ω–µ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è, –∞ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ s2. –ü–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è s1 –Ω–µ–≤–∞–ª–∏–¥–Ω–∞.
-->

---

# Move vs Copy

<div class="grid grid-cols-2 gap-6 mt-4">
<div>

### Move (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

```rust
let s1 = String::from("hello");
let s2 = s1;
// s1 –±–æ–ª—å—à–µ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞
```

<div class="mt-2 text-sm text-gray-400">

–¢–∏–ø—ã –Ω–∞ –∫—É—á–µ: `String`, `Vec`, `Box`, `HashMap`...

</div>

</div>
<div>

### Copy (–¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ç–∏–ø–æ–≤)

```rust
let x = 42;
let y = x;
// x –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –¥–æ—Å—Ç—É–ø–Ω–∞!
println!("{x} {y}"); // ‚úÖ OK
```

<div class="mt-2 text-sm text-gray-400">

–¢–∏–ø—ã –Ω–∞ —Å—Ç–µ–∫–µ: `i32`, `f64`, `bool`, `char`, –∫–æ—Ä—Ç–µ–∂–∏ –∏–∑ Copy-—Ç–∏–ø–æ–≤

</div>

</div>
</div>

<div v-click class="mt-6 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">

–¢—Ä–µ–π—Ç `Copy` —Ä–µ–∞–ª–∏–∑—É—é—Ç —Ç–æ–ª—å–∫–æ —Ç–∏–ø—ã, –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ç–æ—Ä—ã—Ö –¥—ë—à–µ–≤–æ (–ø–æ–±–∏—Ç–æ–≤–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å—Ç–µ–∫–µ)

</div>

<!--
Copy ‚Äî —ç—Ç–æ –º–∞—Ä–∫–µ—Ä–Ω—ã–π —Ç—Ä–µ–π—Ç. –ï—Å–ª–∏ —Ç–∏–ø —Ä–µ–∞–ª–∏–∑—É–µ—Ç Copy, –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–µ –¥–µ–ª–∞–µ—Ç –ø–æ–±–∏—Ç–æ–≤—É—é –∫–æ–ø–∏—é –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è.
-->

---

# Ownership –∏ —Ñ—É–Ω–∫—Ü–∏–∏

```rust {1-3|5-8|10-16|all}
fn takes_ownership(s: String) {
    println!("{s}");
} // s —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è (drop)

fn gives_ownership() -> String {
    let s = String::from("yours");
    s // ownership –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤—ã–∑—ã–≤–∞—é—â–µ–º—É
}

fn main() {
    let s1 = String::from("hello");
    takes_ownership(s1);
    // println!("{s1}");        // ‚ùå s1 moved

    let s2 = gives_ownership();
    println!("{s2}");           // ‚úÖ OK
}
```

<div v-click class="mt-4 text-gray-400">

–ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å ownership –∫–∞–∂–¥—ã–π —Ä–∞–∑ ‚Äî –Ω–µ—É–¥–æ–±–Ω–æ. –ù—É–∂–µ–Ω —Å–ø–æ—Å–æ–± ¬´–æ–¥–æ–ª–∂–∏—Ç—å¬ª –∑–Ω–∞—á–µ–Ω–∏–µ...

</div>

<!--
–ö–∞–∂–¥—ã–π —Ä–∞–∑ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –≤–ª–∞–¥–µ–Ω–∏–µ ‚Äî —É—Ç–æ–º–∏—Ç–µ–ª—å–Ω–æ. –ü–æ—ç—Ç–æ–º—É —Å—É—â–µ—Å—Ç–≤—É–µ—Ç borrowing.
-->

---
layout: section
---

# Borrowing
## –ó–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–µ

---

# –°—Å—ã–ª–∫–∏: &T –∏ &mut T

<div class="grid grid-cols-2 gap-6 mt-4">
<div>

### –ò–º–º—É—Ç–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ `&T`

```rust
fn calculate_len(s: &String) -> usize {
    s.len()
} // s –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ scope, –Ω–æ –¥–∞–Ω–Ω—ã–µ
  // –ù–ï —É–Ω–∏—á—Ç–æ–∂–∞—é—Ç—Å—è ‚Äî –º—ã –Ω–µ –≤–ª–∞–¥–µ–µ–º

fn main() {
    let s = String::from("hello");
    let len = calculate_len(&s);
    println!("{s}: {len}"); // ‚úÖ OK
}
```

</div>
<div>

### –ú—É—Ç–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ `&mut T`

```rust
fn add_world(s: &mut String) {
    s.push_str(", world!");
}

fn main() {
    let mut s = String::from("hello");
    add_world(&mut s);
    println!("{s}");
    // "hello, world!"
}
```

</div>
</div>

<div v-click class="mt-4 p-3 bg-green-500/10 border border-green-500/30 rounded-lg">

Borrowing –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ **–±–µ–∑ –ø–µ—Ä–µ–¥–∞—á–∏ –≤–ª–∞–¥–µ–Ω–∏—è**

</div>

<!--
–°—Å—ã–ª–∫–∏ ‚Äî —ç—Ç–æ borrowing. –ú—ã "–æ–¥–∞–ª–∂–∏–≤–∞–µ–º" –∑–Ω–∞—á–µ–Ω–∏–µ, –Ω–µ –∑–∞–±–∏—Ä–∞—è –≤–ª–∞–¥–µ–Ω–∏–µ. –ò–º–º—É—Ç–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ ‚Äî —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ, –º—É—Ç–∞–±–µ–ª—å–Ω–∞—è ‚Äî —á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å.
-->

---

# –ü—Ä–∞–≤–∏–ª–∞ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏—è

<v-clicks>

1. **–°–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ `&T`** (–∏–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫) –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
2. **–¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ `&mut T`** (–º—É—Ç–∞–±–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞) –≤ –∫–∞–∂–¥—ã–π –º–æ–º–µ–Ω—Ç
3. **`&T` –∏ `&mut T` –Ω–µ –º–æ–≥—É—Ç —Å–æ—Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å**

</v-clicks>

<div v-click class="mt-6">

```rust
let mut s = String::from("hello");

let r1 = &s;      // ‚úÖ OK
let r2 = &s;      // ‚úÖ OK ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ &T —Ä–∞–∑—Ä–µ—à–µ–Ω—ã
// let r3 = &mut s; // ‚ùå –û–®–ò–ë–ö–ê ‚Äî &mut –ø—Ä–∏ –∂–∏–≤—ã—Ö &T

println!("{r1} {r2}");
// r1, r2 –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è (NLL)

let r3 = &mut s;   // ‚úÖ OK ‚Äî r1 –∏ r2 —É–∂–µ "–º–µ—Ä—Ç–≤—ã"
r3.push_str("!");
```

</div>

<div v-click class="mt-2 text-sm text-gray-400">

NLL (Non-Lexical Lifetimes) ‚Äî —Å—Å—ã–ª–∫–∞ "–∂–∏–≤—ë—Ç" –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –∞ –Ω–µ –¥–æ –∫–æ–Ω—Ü–∞ –±–ª–æ–∫–∞

</div>

<!--
NLL ‚Äî —ç—Ç–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ Rust 2018, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Å—Å—ã–ª–æ–∫ —Ç–æ—á–Ω–µ–µ. –°—Å—ã–ª–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –º—ë—Ä—Ç–≤–æ–π –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
-->

---

# –ó–∞—á–µ–º —Ç–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è?

<div class="grid grid-cols-2 gap-6 mt-4">
<div>

### –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ data races

```rust
// –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π:
let mut data = vec![1, 2, 3];

let r = &data[0];  // —Å—Å—ã–ª–∫–∞ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç
data.push(4);      // ‚ùå –º–æ–∂–µ—Ç —Ä–µ–∞–ª–ª–æ—Ü–∏—Ä–æ–≤–∞—Ç—å!
// r —Ç–µ–ø–µ—Ä—å dangling pointer

println!("{r}"); // üí• use-after-free
```

</div>
<div v-click>

### –ê–Ω–∞–ª–æ–≥–∏—è: —á–∏—Ç–∞—Ç–µ–ª–∏ –∏ –ø–∏—Å–∞—Ç–µ–ª–∏

```text
–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:
‚îú‚îÄ‚îÄ –ú–Ω–æ–≥–æ —á–∏—Ç–∞—Ç–µ–ª–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ ‚úÖ
‚îú‚îÄ‚îÄ –û–¥–∏–Ω –ø–∏—Å–∞—Ç–µ–ª—å, –Ω–∏–∫—Ç–æ –Ω–µ —á–∏—Ç–∞–µ—Ç ‚úÖ
‚îî‚îÄ‚îÄ –ü–∏—Å–∞—Ç–µ–ª—å + —á–∏—Ç–∞—Ç–µ–ª–∏ ‚ùå
    (—á–∏—Ç–∞—Ç–µ–ª–∏ —É–≤–∏–¥—è—Ç
     –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
```

<div class="mt-4 text-sm text-gray-400">

–≠—Ç–æ **RwLock** –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è –±–µ–∑ —Ä–∞–Ω—Ç–∞–π–º-–æ–≤–µ—Ä—Ö–µ–¥–∞

</div>

</div>
</div>

<!--
Vec::push –º–æ–∂–µ—Ç —Ä–µ–∞–ª–ª–æ—Ü–∏—Ä–æ–≤–∞—Ç—å –±—É—Ñ–µ—Ä, –∏ —Ç–æ–≥–¥–∞ —Å—Ç–∞—Ä–∞—è —Å—Å—ã–ª–∫–∞ —Å—Ç–∞–Ω–µ—Ç dangling pointer. Borrow checker —ç—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç.
-->

---
layout: section
---

# Borrow Checker
## –°—Ç—Ä–∞–∂ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

# –ß—Ç–æ –¥–µ–ª–∞–µ—Ç Borrow Checker?

<v-clicks>

- –†–∞–±–æ—Ç–∞–µ—Ç **–Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏** (zero-cost)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤—Å–µ —Å—Å—ã–ª–∫–∏ **–≤–∞–ª–∏–¥–Ω—ã**
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç: –Ω–µ—Ç dangling references
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç: –Ω–µ—Ç data races
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏—è (`&T` / `&mut T`)
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç **–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏** (lifetimes) –∫–∞–∂–¥–æ–π —Å—Å—ã–ª–∫–∏

</v-clicks>

<div v-click class="mt-6 p-4 bg-red-500/10 border border-red-500/30 rounded-lg">

**–ï—Å–ª–∏ –∫–æ–¥ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–ª—Å—è ‚Äî –æ–Ω –±–µ–∑–æ–ø–∞—Å–µ–Ω –ø–æ –ø–∞–º—è—Ç–∏** (–±–µ–∑ `unsafe`)

</div>

<!--
Borrow checker ‚Äî —ç—Ç–æ —á–∞—Å—Ç—å –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ Rust. –û–Ω –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –∏ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –≤—Å–µ —Å—Å—ã–ª–∫–∏ –≤–∞–ª–∏–¥–Ω—ã –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –≠—Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å Rust.
-->

---

# Borrow Checker –≤ –¥–µ–π—Å—Ç–≤–∏–∏

````md magic-move
```rust
// ‚ùå Dangling reference
fn dangle() -> &String {
    let s = String::from("hello");
    &s
} // s —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è, —Å—Å—ã–ª–∫–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –≤ –Ω–∏–∫—É–¥–∞!
```

```rust
// ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤–ª–∞–¥–µ–Ω–∏–µ
fn no_dangle() -> String {
    let s = String::from("hello");
    s    // ownership –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –Ω–∞—Ä—É–∂—É
}
```

```rust
// ‚ùå –ú—É—Ç–∞—Ü–∏—è –≤–æ –≤—Ä–µ–º—è –∏—Ç–µ—Ä–∞—Ü–∏–∏
let mut v = vec![1, 2, 3];
for &item in &v {
    if item == 2 {
        v.push(4); // ‚ùå cannot borrow `v` as mutable
    }
}
```

```rust
// ‚úÖ –°–æ–±–∏—Ä–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω–æ
let mut v = vec![1, 2, 3];
let additions: Vec<_> = v.iter()
    .filter(|&&x| x == 2)
    .map(|_| 4)
    .collect();
v.extend(additions); // –º—É—Ç–∞—Ü–∏—è –ø–æ—Å–ª–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏
```
````

<!--
Magic move –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —ç–≤–æ–ª—é—Ü–∏—é –∫–æ–¥–∞: –æ—Ç –æ—à–∏–±–∫–∏ –∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é. Borrow checker –Ω–µ –¥–∞—ë—Ç —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –æ–ø–∞—Å–Ω—ã–π –∫–æ–¥.
-->

---
layout: section
---

# Lifetimes
## –í—Ä–µ–º–µ–Ω–∞ –∂–∏–∑–Ω–∏

---

# –ß—Ç–æ —Ç–∞–∫–æ–µ Lifetime?

<v-clicks>

- Lifetime ‚Äî —ç—Ç–æ **–æ–±–ª–∞—Å—Ç—å –∫–æ–¥–∞**, –≤ –∫–æ—Ç–æ—Ä–æ–π —Å—Å—ã–ª–∫–∞ –≤–∞–ª–∏–¥–Ω–∞
- –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –æ–±—ã—á–Ω–æ –≤—ã–≤–æ–¥–∏—Ç lifetimes **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**
- –ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ **—è–≤–Ω–∞—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è** ‚Äî –∫–æ–≥–¥–∞ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –Ω–µ –º–æ–∂–µ—Ç –≤—ã–≤–µ—Å—Ç–∏
- –°–∏–Ω—Ç–∞–∫—Å–∏—Å: `'a`, `'b`, `'static` (–∞–ø–æ—Å—Ç—Ä–æ—Ñ + –∏–º—è)

</v-clicks>

<div v-click class="mt-6">

```rust {all|2-3|4-5|6-7|all}
fn main() {
    let r;                        // ---------+-- 'a
    {                             //          |
        let x = 5;               // -+-- 'b  |
        r = &x;                  //  |       |
    }                             // -+       |  x —É–Ω–∏—á—Ç–æ–∂–µ–Ω
    // println!("{r}");           //          |  ‚ùå r ‚Äî dangling!
}                                 // ---------+
```

</div>

<div v-click class="mt-2 text-sm text-gray-400">

`'b` –∫–æ—Ä–æ—á–µ —á–µ–º `'a` ‚Üí —Å—Å—ã–ª–∫–∞ `r` –ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ `x` ‚Üí –æ—à–∏–±–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

</div>

<!--
–ö–∞–∂–¥–∞—è —Å—Å—ã–ª–∫–∞ –∏–º–µ–µ—Ç lifetime ‚Äî —Å–∫–æ–ª—å–∫–æ –æ–Ω–∞ "–∂–∏–≤—ë—Ç". –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∂–∏–≤—É—Ç –¥–æ–ª—å—à–µ —Å—Å—ã–ª–æ–∫ –Ω–∞ –Ω–∏—Ö.
-->

---

# –Ø–≤–Ω—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ Lifetime

–ö–æ–≥–¥–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç **–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Å—ã–ª–æ–∫** –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Å—ã–ª–∫—É ‚Äî –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—É –Ω—É–∂–Ω–∞ –ø–æ–¥—Å–∫–∞–∑–∫–∞:

```rust
// ‚ùå –ù–µ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è ‚Äî –∫–∞–∫–æ–π lifetime —É –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–π —Å—Å—ã–ª–∫–∏?
fn longest(x: &str, y: &str) -> &str {
    if x.len() > y.len() { x } else { y }
}
```

<div v-click>

```rust
// ‚úÖ –Ø–≤–Ω—ã–π lifetime: —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∂–∏–≤—ë—Ç —Å—Ç–æ–ª—å–∫–æ, —Å–∫–æ–ª—å–∫–æ –∂–∏–≤—É—Ç –û–ë–ê –∞—Ä–≥—É–º–µ–Ω—Ç–∞
fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {
    if x.len() > y.len() { x } else { y }
}
```

</div>

<div v-click class="mt-4 p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">

`'a` –Ω–µ –º–µ–Ω—è–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ ‚Äî —ç—Ç–æ **–∫–æ–Ω—Ç—Ä–∞–∫—Ç**: ¬´—Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–µ–Ω –Ω–µ –¥–æ–ª—å—à–µ, —á–µ–º –æ–±–∞ –≤—Ö–æ–¥–∞¬ª

</div>

<!--
–ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏ lifetime ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏. –≠—Ç–æ –ø—Ä–æ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—É, –∫–∞–∫ —Å–≤—è–∑–∞–Ω—ã –≤—Ä–µ–º–µ–Ω–∞ –∂–∏–∑–Ω–∏ —Ä–∞–∑–Ω—ã—Ö —Å—Å—ã–ª–æ–∫.
-->

---

# Lifetime –≤ –¥–µ–π—Å—Ç–≤–∏–∏

```rust {all|1-3|5-11|7-8|9-10|all}
fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {
    if x.len() > y.len() { x } else { y }
}

fn main() {
    let string1 = String::from("long string");
    let result;
    {
        let string2 = String::from("xyz");
        result = longest(string1.as_str(), string2.as_str());
        println!("Longest: {result}"); // ‚úÖ OK ‚Äî –æ–±–∞ –∂–∏–≤—ã
    }
    // println!("{result}"); // ‚ùå string2 —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∞
}
```

<div v-click class="mt-4">

`'a` –ø–æ–ª—É—á–∞–µ—Ç **–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ** (–º–∏–Ω–∏–º—É–º) lifetimes –æ–±–æ–∏—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–µ–Ω —Ç–æ–ª—å–∫–æ –ø–æ–∫–∞ –∂–∏–≤—ã **–æ–±–∞**

</div>

<!--
Lifetime 'a ‚Äî —ç—Ç–æ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ lifetimes –¥–≤—É—Ö –≤—Ö–æ–¥–Ω—ã—Ö —Å—Å—ã–ª–æ–∫. –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∂–∏—Ç—å –Ω–∏ –æ–¥–∏–Ω –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.
-->

---

# Lifetime Elision Rules

–ö–æ–º–ø–∏–ª—è—Ç–æ—Ä **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç lifetimes –ø–æ —Ç—Ä—ë–º –ø—Ä–∞–≤–∏–ª–∞–º:

<v-clicks>

1. **–ö–∞–∂–¥—ã–π –≤—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä-—Å—Å—ã–ª–∫–∞** –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–π lifetime
   - `fn foo(x: &str, y: &str)` ‚Üí `fn foo<'a, 'b>(x: &'a str, y: &'b str)`

2. **–ï—Å–ª–∏ –æ–¥–∏–Ω –≤—Ö–æ–¥–Ω–æ–π lifetime** ‚Üí –æ–Ω –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –≤—Å–µ–º –≤—ã—Ö–æ–¥–Ω—ã–º —Å—Å—ã–ª–∫–∞–º
   - `fn foo(x: &str) -> &str` ‚Üí `fn foo<'a>(x: &'a str) -> &'a str`

3. **–ï—Å–ª–∏ –µ—Å—Ç—å `&self` / `&mut self`** ‚Üí –µ–≥–æ lifetime –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –≤—ã—Ö–æ–¥–Ω—ã–º
   - `fn foo(&self, x: &str) -> &str` ‚Üí lifetime –æ—Ç `&self`

</v-clicks>

<div v-click class="mt-6 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">

–ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ç—Ä—ë—Ö –ø—Ä–∞–≤–∏–ª –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç—å ‚Üí –Ω—É–∂–Ω–∞ **—è–≤–Ω–∞—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è**

</div>

<!--
Elision rules ‚Äî —ç—Ç–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π —Å–∞—Ö–∞—Ä. –í —Ä–∞–Ω–Ω–∏—Ö –≤–µ—Ä—Å–∏—è—Ö Rust –ø—Ä–∏—Ö–æ–¥–∏–ª–æ—Å—å –ø–∏—Å–∞—Ç—å –≤—Å–µ lifetimes —è–≤–Ω–æ. –°–µ–π—á–∞—Å –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –≤—ã–≤–æ–¥–∏—Ç –∏—Ö –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤.
-->

---

# –ü—Ä–∏–º–µ—Ä—ã Elision

<div class="grid grid-cols-2 gap-6 mt-2">
<div>

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥ ‚úÖ

```rust
// –ü—Ä–∞–≤–∏–ª–æ 2: –æ–¥–∏–Ω –≤—Ö–æ–¥ ‚Üí –æ–¥–∏–Ω –≤—ã—Ö–æ–¥
fn first_word(s: &str) -> &str {
    // ...
}
// = fn first_word<'a>(s: &'a str) -> &'a str

// –ü—Ä–∞–≤–∏–ª–æ 3: &self ‚Üí –≤—ã—Ö–æ–¥
impl MyStruct {
    fn name(&self) -> &str {
        &self.name
    }
}
```

</div>
<div>

### –ù—É–∂–Ω–∞ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è ‚úã

```rust
// –î–≤–∞ –≤—Ö–æ–¥–∞, –æ–¥–∏–Ω –≤—ã—Ö–æ–¥ ‚Äî –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ
fn longest(x: &str, y: &str) -> &str
// ‚ùå –ß–µ–π lifetime —É –≤—ã—Ö–æ–¥–∞?

// –ò—Å–ø—Ä–∞–≤–ª—è–µ–º:
fn longest<'a>(
    x: &'a str,
    y: &'a str,
) -> &'a str {
    if x.len() > y.len() { x } else { y }
}
```

</div>
</div>

<!--
Elision –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ø—Ä–æ—â–∞–µ—Ç –∫–æ–¥. –í 90% —Å–ª—É—á–∞–µ–≤ lifetimes –≤—ã–≤–æ–¥—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
-->

---

# Lifetime –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö

–ï—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–∏—Ç **—Å—Å—ã–ª–∫—É** ‚Äî –Ω—É–∂–µ–Ω lifetime-–ø–∞—Ä–∞–º–µ—Ç—Ä:

```rust {all|1-4|6-11|13-17|all}
struct Excerpt<'a> {
    text: &'a str,   // —Å—Å—ã–ª–∫–∞ –∂–∏–≤—ë—Ç –∫–∞–∫ –º–∏–Ω–∏–º—É–º 'a
}

// –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç–æ–∂–µ –æ–±—ä—è–≤–ª—è–µ—Ç lifetime
impl<'a> Excerpt<'a> {
    fn level(&self) -> i32 {
        3
    }

    // Elision –ø—Ä–∞–≤–∏–ª–æ 3: lifetime –æ—Ç &self
    fn announce(&self, announcement: &str) -> &str {
        println!("Attention: {announcement}");
        self.text
    }
}
```

<div v-click class="mt-4 p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">

**–ö–æ–Ω—Ç—Ä–∞–∫—Ç**: —ç–∫–∑–µ–º–ø–ª—è—Ä `Excerpt` –Ω–µ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∂–∏—Ç—å –¥–∞–Ω–Ω—ã–µ, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ —Å—Å—ã–ª–∞–µ—Ç—Å—è `text`

</div>

<!--
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ —Å—Å—ã–ª–∫–æ–π –¥–æ–ª–∂–Ω–∞ –æ–±—ä—è–≤–∏—Ç—å lifetime-–ø–∞—Ä–∞–º–µ—Ç—Ä. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ —Å—Å—ã–ª–∞–µ—Ç—Å—è –ø–æ–ª–µ, –∂–∏–≤—É—Ç –¥–æ–ª—å—à–µ —Å–∞–º–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
-->

---

# Lifetime –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö: –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```rust {all|1-3|5-10|12-14|all}
struct Excerpt<'a> {
    text: &'a str,
}

fn main() {
    let novel = String::from(
        "Call me Ishmael. Some years ago..."
    );
    let first_sentence = novel.split('.').next().unwrap();
    let excerpt = Excerpt { text: first_sentence };

    println!("Excerpt: {}", excerpt.text);
    // ‚úÖ OK: novel (–≤–ª–∞–¥–µ–ª–µ—Ü –¥–∞–Ω–Ω—ã—Ö) –∂–∏–≤—ë—Ç –¥–æ–ª—å—à–µ excerpt
}
```

<div v-click>

```rust
fn broken() {
    let excerpt;
    {
        let novel = String::from("hello");
        excerpt = Excerpt { text: &novel };
    } // ‚ùå novel —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∞, excerpt —Ö—Ä–∞–Ω–∏—Ç dangling ref
    // println!("{}", excerpt.text);
}
```

</div>

<!--
–ü—Ä–∏–º–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ lifetime –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç dangling references. –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –Ω–µ –¥–∞—Å—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ—Å–ª–µ —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
-->

---

# 'static Lifetime

`'static` ‚Äî –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –≤—Å–µ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã:

```rust
// –°—Ç—Ä–æ–∫–æ–≤—ã–µ –ª–∏—Ç–µ—Ä–∞–ª—ã –≤—Å–µ–≥–¥–∞ 'static (–≤—à–∏—Ç—ã –≤ –±–∏–Ω–∞—Ä–Ω–∏–∫)
let s: &'static str = "I live forever";

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã ‚Äî –≤—Å–µ–≥–¥–∞ 'static
const MAX: &'static i32 = &100;
```

<div v-click class="mt-4">

### 'static –≤ trait bounds

```rust
// T –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–ª–∞–¥–µ—é—â–∏–º —Ç–∏–ø–æ–º (–±–µ–∑ —Å—Å—ã–ª–æ–∫) –ò–õ–ò 'static —Å—Å—ã–ª–∫–æ–π
fn spawn_thread<T: Send + 'static>(value: T) {
    std::thread::spawn(move || {
        println!("{value:?}");
    });
}
```

</div>

<div v-click class="mt-4 p-3 bg-red-500/10 border border-red-500/30 rounded-lg">

‚ö†Ô∏è `T: 'static` **–Ω–µ –æ–∑–Ω–∞—á–∞–µ—Ç** ¬´–∂–∏–≤—ë—Ç –≤–µ—á–Ω–æ¬ª ‚Äî –æ–∑–Ω–∞—á–∞–µ—Ç ¬´**–º–æ–∂–µ—Ç** –∂–∏—Ç—å —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ –¥–æ–ª–≥–æ¬ª (–Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å—Å—ã–ª–æ–∫)

</div>

<!--
'static ‚Äî —ç—Ç–æ —Å–∞–º–æ–µ —á–∞—Å—Ç–æ–µ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–µ –≤ Rust. T: 'static –Ω–µ –∑–Ω–∞—á–∏—Ç "—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è", –∞ –∑–Ω–∞—á–∏—Ç "—Ç–∏–ø –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ-static —Å—Å—ã–ª–æ–∫". String ‚Äî —ç—Ç–æ 'static, —Ö–æ—Ç—è –∂–∏–≤—ë—Ç –Ω–µ –≤–µ—á–Ω–æ.
-->

---
layout: section
---

# –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏
## –ò –∫–∞–∫ –∏—Ö –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å

---

# –û—à–∏–±–∫–∞: –≤–æ–∑–≤—Ä–∞—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

````md magic-move
```rust
// ‚ùå error[E0106]: missing lifetime specifier
fn make_greeting(name: &str) -> &str {
    let greeting = format!("Hello, {name}!");
    &greeting  // —Å—Å—ã–ª–∫–∞ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é!
}
```

```rust
// ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤–ª–∞–¥–µ—é—â–∏–π —Ç–∏–ø
fn make_greeting(name: &str) -> String {
    format!("Hello, {name}!")
}
```
````

<div v-click class="mt-6">

### –ü—Ä–∞–≤–∏–ª–æ: –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ **–≤–ª–∞–¥–µ—é—â–∏–π —Ç–∏–ø**, –Ω–µ —Å—Å—ã–ª–∫—É

| –°—Å—ã–ª–∫–∞ | –í–ª–∞–¥–µ—é—â–∏–π —Ç–∏–ø |
|--------|---------------|
| `&str` | `String` |
| `&[T]` | `Vec<T>` |
| `&T`   | `Box<T>` –∏–ª–∏ `T` |

</div>

<!--
–°–∞–º–∞—è —á–∞—Å—Ç–∞—è –æ—à–∏–±–∫–∞ –Ω–æ–≤–∏—á–∫–æ–≤ ‚Äî –ø–æ–ø—ã—Ç–∫–∞ –≤–µ—Ä–Ω—É—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –¥–∞–Ω–Ω—ã–µ, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏. –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–Ω–∏—á—Ç–æ–∂–µ–Ω—ã –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ.
-->

---

# –û—à–∏–±–∫–∞: –º—É—Ç–∞—Ü–∏—è –ø—Ä–∏ –∂–∏–≤—ã—Ö —Å—Å—ã–ª–∫–∞—Ö

````md magic-move
```rust
// ‚ùå cannot borrow `v` as mutable because it is also borrowed as immutable
fn main() {
    let mut v = vec![1, 2, 3, 4, 5];
    let first = &v[0];      // –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã–π borrow
    v.push(6);               // –º—É—Ç–∞–±–µ–ª—å–Ω—ã–π borrow ‚ùå
    println!("first: {first}");
}
```

```rust
// ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 1: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –î–û –º—É—Ç–∞—Ü–∏–∏
fn main() {
    let mut v = vec![1, 2, 3, 4, 5];
    let first = &v[0];
    println!("first: {first}");  // –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ ‚Äî —Å—Å—ã–ª–∫–∞ –º–µ—Ä—Ç–≤–∞ (NLL)
    v.push(6);                    // ‚úÖ OK
}
```

```rust
// ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 2: —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
fn main() {
    let mut v = vec![1, 2, 3, 4, 5];
    let first = v[0];            // –∫–æ–ø–∏—è i32 (Copy trait)
    v.push(6);                    // ‚úÖ OK ‚Äî –Ω–µ—Ç —Å—Å—ã–ª–æ–∫
    println!("first: {first}");
}
```
````

<!--
Vec::push –º–æ–∂–µ—Ç —Ä–µ–∞–ª–ª–æ—Ü–∏—Ä–æ–≤–∞—Ç—å –±—É—Ñ–µ—Ä, –∏ —Ç–æ–≥–¥–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å—Ç–∞–Ω–µ—Ç dangling. Borrow checker —ç—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç.
-->

---

# –û—à–∏–±–∫–∞: –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∏–∑ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

````md magic-move
```rust
// ‚ùå cannot move out of `*item` which is behind a shared reference
fn remove_first_match(items: &Vec<String>, target: &str) -> Option<String> {
    for item in items {
        if item == target {
            return Some(*item);  // ‚ùå –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–±—Ä–∞—Ç—å ownership —á–µ—Ä–µ–∑ &
        }
    }
    None
}
```

```rust
// ‚úÖ –ö–ª–æ–Ω–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
fn find_match(items: &[String], target: &str) -> Option<String> {
    for item in items {
        if item == target {
            return Some(item.clone());  // ‚úÖ —Å–æ–∑–¥–∞—ë–º –∫–æ–ø–∏—é
        }
    }
    None
}
```

```rust
// ‚úÖ –ò–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Å—ã–ª–∫—É
fn find_match<'a>(items: &'a [String], target: &str) -> Option<&'a str> {
    for item in items {
        if item == target {
            return Some(item.as_str());  // ‚úÖ —Å—Å—ã–ª–∫–∞, –Ω–µ –≤–ª–∞–¥–µ–Ω–∏–µ
        }
    }
    None
}
```
````

<!--
–ù–µ–ª—å–∑—è –∑–∞–±—Ä–∞—Ç—å –≤–ª–∞–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ shared reference. –õ–∏–±–æ –∫–ª–æ–Ω–∏—Ä—É–µ–º, –ª–∏–±–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Å—ã–ª–∫—É.
-->

---
layout: two-cols
---

# –ü–∞—Ç—Ç–µ—Ä–Ω—ã —Ä–∞–±–æ—Ç—ã —Å Borrow Checker

### –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

```rust
// –ü—Ä–æ—Å—Ç–æ, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ—Ä–æ–≥–æ
let data = original.clone();
process(&data);
```

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º—É—Ç–∞–±–µ–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

```rust
let mut v = vec![1, 2, 3, 4, 5];
// split_at_mut —Ä–∞–∑–¥–µ–ª—è–µ—Ç –Ω–∞ 2 &mut
let (left, right) = v.split_at_mut(3);
left[0] = 10;
right[0] = 40;
```

::right::

<div class="ml-4">

### Scoping (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ scope)

```rust
let mut map = HashMap::new();
{
    let entry = map.entry("key");
    entry.or_insert(0);
} // —Å—Å—ã–ª–∫–∞ –º–µ—Ä—Ç–≤–∞
map.insert("other", 1); // ‚úÖ
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤

```rust
let mut v = vec![1, 2, 3];
let idx = v.iter()
    .position(|&x| x == 2)
    .unwrap();
// –ò–Ω–¥–µ–∫—Å ‚Äî –Ω–µ —Å—Å—ã–ª–∫–∞!
v[idx] = 20; // ‚úÖ
```

</div>

<!--
–ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å borrow checker. –°–æ –≤—Ä–µ–º–µ–Ω–µ–º –¥—É–º–∞—Ç—å –≤ —Ç–µ—Ä–º–∏–Ω–∞—Ö ownership —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º.
-->

---

# Lifetime –≤ –∑–∞–º—ã–∫–∞–Ω–∏—è—Ö –∏ –∏—Ç–µ—Ä–∞—Ç–æ—Ä–∞—Ö

```rust {all|1-7|9-15|all}
// –ó–∞–º—ã–∫–∞–Ω–∏–µ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Å—Å—ã–ª–∫—É ‚Äî lifetime –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –¥–∞–Ω–Ω—ã–º
fn get_filter<'a>(threshold: &'a i32) -> impl Fn(&i32) -> bool + 'a {
    move |x| x > threshold
}
// –ó–∞–º—ã–∫–∞–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∂–∏—Ç—å threshold

// –ò—Ç–µ—Ä–∞—Ç–æ—Ä—ã —á–∞—Å—Ç–æ –∑–∞–∏–º—Å—Ç–≤—É—é—Ç –¥–∞–Ω–Ω—ã–µ
fn first_positive(numbers: &[i32]) -> Option<&i32> {
    numbers.iter().find(|&&x| x > 0)
    // Lifetime –≤—ã–≤–æ–¥–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (elision rule 2)
}

fn main() {
    let nums = vec![-1, -2, 3, 4];
    let result = first_positive(&nums);
    println!("{:?}", result); // Some(3)
}
```

<!--
–ó–∞–º—ã–∫–∞–Ω–∏—è –∏ –∏—Ç–µ—Ä–∞—Ç–æ—Ä—ã —á–∞—Å—Ç–æ —Ä–∞–±–æ—Ç–∞—é—Ç —Å–æ —Å—Å—ã–ª–∫–∞–º–∏. Borrow checker –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç lifetimes —á–µ—Ä–µ–∑ –≤—Å—é —Ü–µ–ø–æ—á–∫—É –≤—ã–∑–æ–≤–æ–≤.
-->

---

# –ö–æ–≥–¥–∞ Borrow Checker ¬´–º–µ—à–∞–µ—Ç¬ª

–ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –æ–±–æ–π—Ç–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è ‚Äî Rust –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç **–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ** –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

<div class="grid grid-cols-2 gap-6 mt-4">
<div>

### Interior Mutability

```rust
use std::cell::RefCell;

let data = RefCell::new(vec![1, 2, 3]);

// –ù–µ—Å–∫–æ–ª—å–∫–æ "–º—É—Ç–∞–±–µ–ª—å–Ω—ã—Ö" –¥–æ—Å—Ç—É–ø–æ–≤
// —á–µ—Ä–µ–∑ –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
let mut borrow = data.borrow_mut();
borrow.push(4);
```

<div class="mt-2 text-sm text-gray-400">

`Cell`, `RefCell` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ —Ä–∞–Ω—Ç–∞–π–º–µ

</div>

</div>
<div>

### Shared Ownership

```rust
use std::rc::Rc;

let a = Rc::new(String::from("shared"));
let b = Rc::clone(&a);
let c = Rc::clone(&a);

// –¢—Ä–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –æ–¥–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö!
println!("{a} {b} {c}");
```

<div class="mt-2 text-sm text-gray-400">

`Rc` (single-thread), `Arc` (multi-thread)

</div>

</div>
</div>

<div v-click class="mt-4 p-3 bg-orange-500/10 border border-orange-500/30 rounded-lg">

–≠—Ç–∏ —Ç–∏–ø—ã **–Ω–µ –æ—Ç–∫–ª—é—á–∞—é—Ç** safety ‚Äî –æ–Ω–∏ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ —Ä–∞–Ω—Ç–∞–π–º

</div>

<!--
RefCell, Rc, Arc ‚Äî —ç—Ç–æ –Ω–µ "–æ–±—Ö–æ–¥—ã" —Å–∏—Å—Ç–µ–º—ã. –≠—Ç–æ –ª–µ–≥–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –≤—ã—Ä–∞–∂–∞—é—Ç—Å—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏.
-->

---

# –®–ø–∞—Ä–≥–∞–ª–∫–∞: —á—Ç–æ –≤—ã–±—Ä–∞—Ç—å?

<div class="mt-4">

| –°–∏—Ç—É–∞—Ü–∏—è | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| –ù—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ | `&T` |
| –ù—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ | `&mut T` |
| –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞—ë—Ç –¥–∞–Ω–Ω—ã–µ | –í–æ–∑–≤—Ä–∞—â–∞—Ç—å `T` (–≤–ª–∞–¥–µ–Ω–∏–µ), –Ω–µ `&T` |
| –ù–µ—Å–∫–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ (–æ–¥–∏–Ω –ø–æ—Ç–æ–∫) | `Rc<T>` |
| –ù–µ—Å–∫–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ (–ø–æ—Ç–æ–∫–∏) | `Arc<T>` |
| –ú—É—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ `&T` | `Cell<T>` / `RefCell<T>` |
| –ú—É—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ `Arc<T>` | `Arc<Mutex<T>>` |
| ¬´–ë–æ—Ä—é—Å—å —Å borrow checker¬ª | `.clone()` ‚Äî –ø–æ—Ç–æ–º –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å |

</div>

<div v-click class="mt-4 p-3 bg-green-500/10 border border-green-500/30 rounded-lg">

üí° –°–æ–≤–µ—Ç: –Ω–∞—á–∏–Ω–∞–π—Ç–µ —Å `.clone()` ‚Äî –ø–æ—Ç–æ–º –ø—Ä–æ—Ñ–∏–ª–∏—Ä—É–π—Ç–µ –∏ —É–±–∏—Ä–∞–π—Ç–µ –ª–∏—à–Ω–∏–µ –∫–æ–ø–∏–∏

</div>

<!--
–ù–µ –±–æ–π—Ç–µ—Å—å clone. –õ—É—á—à–µ —Ä–∞–±–æ—á–∏–π –∫–æ–¥ —Å –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º, —á–µ–º –≤–µ—á–Ω–∞—è –±–æ—Ä—å–±–∞ —Å borrow checker. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –ø–æ—Ç–æ–º.
-->

---
layout: section
---

# –ò—Ç–æ–≥–∏

---

# –ß—Ç–æ –¥–∞—ë—Ç Borrow Checker?

<v-clicks>

- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–∞–º—è—Ç–∏** –±–µ–∑ —Å–±–æ—Ä—â–∏–∫–∞ –º—É—Å–æ—Ä–∞
- **–ù–µ—Ç data races** ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
- **–ù–µ—Ç null pointer / dangling reference** ‚Äî –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ –¥–∏–∑–∞–π–Ω—É
- **Zero-cost abstractions** ‚Äî –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
- **–õ—É—á—à–∏–π –¥–∏–∑–∞–π–Ω** ‚Äî ownership –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –¥—É–º–∞—Ç—å –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∞–Ω–Ω—ã—Ö
- **Fearless concurrency** ‚Äî –µ—Å–ª–∏ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–ª–æ—Å—å, –ø–æ—Ç–æ–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã

</v-clicks>

<div v-click class="mt-8 p-4 bg-green-500/10 border border-green-500/30 rounded-lg text-center">

> ¬´If it compiles, it works¬ª ‚Äî –Ω–µ –∞–±—Å–æ–ª—é—Ç–Ω–∞—è –∏—Å—Ç–∏–Ω–∞, –Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–∞–º—è—Ç–∏ ‚Äî **–¥–∞**

</div>

<!--
Borrow checker ‚Äî —ç—Ç–æ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ, –∞ —Å—É–ø–µ—Ä—Å–∏–ª–∞. –û–Ω –ª–æ–≤–∏—Ç —Ü–µ–ª—ã–µ –∫–ª–∞—Å—Å—ã –±–∞–≥–æ–≤ –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤ C++ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.
-->

---
layout: center
class: text-center
---

# –°–ø–∞—Å–∏–±–æ!

<div class="text-xl mt-4 text-gray-400">

Rust Book, –≥–ª–∞–≤–∞ 4: Ownership ‚Üí [doc.rust-lang.org/book/ch04-00-understanding-ownership.html](https://doc.rust-lang.org/book/ch04-00-understanding-ownership.html)

Rust Book, –≥–ª–∞–≤–∞ 10.3: Lifetimes ‚Üí [doc.rust-lang.org/book/ch10-03-lifetime-syntax.html](https://doc.rust-lang.org/book/ch10-03-lifetime-syntax.html)

</div>

<div class="mt-8 text-gray-500">
  –í–æ–ø—Ä–æ—Å—ã?
</div>

<!--
–°—Å—ã–ª–∫–∏ –Ω–∞ –≥–ª–∞–≤—ã Rust Book –¥–ª—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è.
-->
